<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>FreeBusAVR: lib/fb_hal.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>lib/fb_hal.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Freebus Hardware Layer. Implementation of a software- uart + timer handling This file consists of function which are bound to the hardware For further information check the pdf 03_02_02 Communication Medium TP 1 v1.0 AS.PDF.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="fb_8h_source.html">fb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fb__hardware_8h_source.html">fb_hardware.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="freebus-debug_8h_source.html">freebus-debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fb__eeprom_8h_source.html">fb_eeprom.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fb__prot_8h_source.html">fb_prot.h</a>&quot;</code><br/>
<code>#include &quot;fbrf_prot.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="fb__hal_8h_source.html">fb_hal.h</a>&quot;</code><br/>
<code>#include &quot;fbrf_hal.h&quot;</code><br/>
<code>#include &quot;rf22.h&quot;</code><br/>
<code>#include &quot;Spi.h&quot;</code><br/>
<!-- startSectionHeader --><div class="dynheader">
Include dependency graph for fb_hal.c:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c__incl.png" border="0" usemap="#lib_2fb__hal_8c" alt=""/></div>
<map name="lib_2fb__hal_8c" id="lib_2fb__hal_8c">
<area shape="rect" id="node3" href="fb_8h.html" title="Define general values used in bus communication." alt="" coords="5,237,51,267"/><area shape="rect" id="node5" href="fb__hardware_8h.html" title="Hardware specific options which includes the platforms (like ATmega8, ATmega168...)" alt="" coords="269,237,381,267"/><area shape="rect" id="node7" href="freebus-debug_8h.html" title="Header file to map debugging between several output devices. Possible outputs are lcd..." alt="" coords="651,83,776,112"/><area shape="rect" id="node15" href="fb__eeprom_8h.html" title="Handling the access and mapping to the eeprom." alt="" coords="800,83,901,112"/><area shape="rect" id="node17" href="fb__prot_8h.html" title="Define the protocol specific definitions Implementation of the communication protocol." alt="" coords="132,83,209,112"/><area shape="rect" id="node28" href="rf_2rf22-controller_2fbrf__prot_8h_source.html" title="fbrf_prot.h" alt="" coords="539,83,627,112"/><area shape="rect" id="node38" href="fb__hal_8h.html" title="Definitions on Hardware Abstration Layer." alt="" coords="327,83,399,112"/><area shape="rect" id="node45" href="rf_2rf22-controller_2fbrf__hal_8h_source.html" title="fbrf_hal.h" alt="" coords="432,83,512,112"/><area shape="rect" id="node50" href="rf_2rf22-controller_2rf22_8h_source.html" title="rf22.h" alt="" coords="925,83,984,112"/><area shape="rect" id="node52" href="rf_2rf22-controller_2Spi_8h_source.html" title="Spi.h" alt="" coords="1013,83,1067,112"/><area shape="rect" id="node11" href="lcd-lib_8h.html" title="lcd&#45;lib.h" alt="" coords="764,160,833,189"/><area shape="rect" id="node13" href="delay_8h.html" title="Functions to delay the execution." alt="" coords="765,237,832,267"/><area shape="rect" id="node20" href="msg__queue_8h.html" title="Definitions for the message queue system used for telegrams and communucation like debugging (also rs..." alt="" coords="116,160,225,189"/><area shape="rect" id="node30" href="fbrf22_8h_source.html" title="fbrf22.h" alt="" coords="671,160,740,189"/><area shape="rect" id="node32" href="rfmsg__queue_8h_source.html" title="rfmsg_queue.h" alt="" coords="529,160,647,189"/><area shape="rect" id="node34" href="fbrf__hardware_8h_source.html" title="fbrf_hardware.h" alt="" coords="528,237,648,267"/><area shape="rect" id="node36" href="fbrf-atmega8_8h_source.html" title="fbrf&#45;atmega8.h" alt="" coords="529,315,647,344"/></map>
<!-- endSectionContent --></div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5bc9e0c4692fe7cfc1c0689899e3bd41"></a><!-- doxytag: member="fb_hal.c::_FB_HAL_C" ref="a5bc9e0c4692fe7cfc1c0689899e3bd41" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>_FB_HAL_C</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a7bb97dbc2abccfc6ec4a1da276be1352">EIB_BIT_TIME</a>&#160;&#160;&#160;F_CPU/(8000000/104)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">duration of one bit on the EIB  <a href="#a7bb97dbc2abccfc6ec4a1da276be1352"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a832e9cd092f6ebab14ef4410263d165c"></a><!-- doxytag: member="fb_hal.c::EIB_TX_LOWTIME" ref="a832e9cd092f6ebab14ef4410263d165c" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EIB_TX_LOWTIME</b>&#160;&#160;&#160;EIB_BIT_TIME / 3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#ac7553420ae73a48c64bc99ebae0cb1ed">EIB_NONE_MODE</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">the receive and sending part is in idle mode  <a href="#ac7553420ae73a48c64bc99ebae0cb1ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a45a3ce976119aa33a25ed9f6bd62800b">EIB_SEND_MODE</a>&#160;&#160;&#160;(1&lt;&lt;0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">defines that we're in send mode, if the ISR is triggered the send functions are called  <a href="#a45a3ce976119aa33a25ed9f6bd62800b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a39180a8413181162f840090a165a53c9">EIB_RECEIVE_MODE</a>&#160;&#160;&#160;(1&lt;&lt;1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">defines that we're in receive mode, if the ISR is triggered the receive functions are called  <a href="#a39180a8413181162f840090a165a53c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a56e22527b5751ef05494c349efbf3efc">EIB_CHECK_FOR_COLLISION</a>&#160;&#160;&#160;(1&lt;&lt;2)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">defined if in transmit mode we have to check if a collision occured  <a href="#a56e22527b5751ef05494c349efbf3efc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a4840974af68cdfcf383a6408cf7897fa">START_TX</a>()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">start timer: Timer0 using only timer0 to have timer1 and timer2 free for the application  <a href="#a4840974af68cdfcf383a6408cf7897fa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>DISABLE_RF_INTERRUPTS</b>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>ENABLE_RF_INTERRUPTS</b>()</td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780b">etimer_state</a> { <br/>
&#160;&#160;<a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780ba95f116553b8e2d1cd7be8a22840d1cf2">TS_WAITING_CHARS</a> =  0x00, 
<a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780ba4edb33432ce91da9dbc2877fa520fc2f">TS_WAITING_TIMEOUT</a>, 
<a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780ba33c7a599ee9d3fbffdd9424fa8103a74">TS_WAITING_ACK</a>, 
<a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780baea28c3b68095d1841dc25772ee911ccf">TS_WAITING_ACK_RESP</a>, 
<br/>
&#160;&#160;<a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780baafdffc11056a3e174f83508e3977d6e2">TS_WAITING_BUS_FREE</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Status for receiving mode, is used in the ISR to decide which function must be called next. </p>
 <a href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780b">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcb">etx_state</a> { <br/>
&#160;&#160;<a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcba95f419c69e376d2b98405394bdb5fa1c">TX_NONE</a> =  0x00, 
<a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcba392e67967765fc36b13fa57431d05e6d">TX_SEND_DATA</a>, 
<a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcba0e7b1023eb5c47a8c27126c4c6320e3c">TX_SEND_CHECKSUM</a>, 
<a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcba9b380c6ca3d4b5a70e5649ca12f180ff">TX_WAITING_ACK</a>, 
<br/>
&#160;&#160;<a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcbaae441d024d64d59f65315abb3112bfec">TX_ERROR</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Status for transmitting mode, is used in the ISR to decide which function must be called next. </p>
 <a href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcb">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a85ef2600dfae61cd15f445efbc31fb60">fbhal_checkProgTaster</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the programm button and set programming mode and switch LED depending on programming mode.  <a href="#a85ef2600dfae61cd15f445efbc31fb60"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a296f7c3289677f2b99af85e65dfd04e0">fb_send_ack</a> (uint8_t <a class="el" href="fb__ain10v_8c.html#a3f0c55f449560b03ce0ac43270c26600">value</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to set the ack value for the response to a telegram which must be send in a absolutly excat timing.  <a href="#a296f7c3289677f2b99af85e65dfd04e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#adc42490ec5de72809d53c35e57198de6">fb_hal_restart</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Restart the application by activating the watchdog and block the program.  <a href="#adc42490ec5de72809d53c35e57198de6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#abbf23a2adcf8b8280c8ce17d4a12951b">fb_hal_txqueue_msg</a> (struct <a class="el" href="structmsg.html">msg</a> *tx)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue message for sending.  <a href="#abbf23a2adcf8b8280c8ce17d4a12951b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a30c6b413389944e9362e0bb20467962e">panic</a> (uint8_t reason)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Hold application and set blink code to PORTB pin 0, our prog pin and LED.  <a href="#a30c6b413389944e9362e0bb20467962e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fb__hal_8c.html#a1d2bce7e6ac0dd55aa811e53722ea4be">fbhal_Init</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set input/output mode to PORTs, init timers and interrupts.  <a href="#a1d2bce7e6ac0dd55aa811e53722ea4be"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Freebus Hardware Layer. Implementation of a software- uart + timer handling This file consists of function which are bound to the hardware For further information check the pdf 03_02_02 Communication Medium TP 1 v1.0 AS.PDF. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Dirk Opfer, Matthias Fechner, Christian Bode, Dirk Armbrust </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>Fri Oct 26 17:22:16 2007</dd></dl>
<p>One bit has the length of 104us (35us date and 69us wait time).<br/>
 One character is then 11*104us=1144us.</p>
<p>After a character we have a waiting time of 2 bits that means 208us before we start with the next start bit.</p>
<p>When the telgram is complete the ackknowledge is sent after 13 bit wait time that means 13*104us=1352us</p>
<p>After the acknowledge the device have to wait 50 bits that means bus is free after 50*104us=5200us + wait time for priority The wait time for priority depends on the priority and is:</p>
<ul>
<li>low (4) or high (3): wait 3 bits 3*104us=312us</li>
<li>system (2) or alarm (1): no waiting time</li>
</ul>
<p>The IACK or INACK has no waiting time and will immediatly be transmitted.</p>
<p>So the waiting time for received mode will be: -EXT INT triggered: Timer0 wait 104탎 for bit 0 -Timer0 wait 104탎 for each next bit (bit 1, 2, 3, 4, 5, 6, 7, P, S) till full character received -Timer0 wait 2*104탎 (wait time between character) = 208탎 and start ACK timer with TIMER0 1352탎, enable EXT INT -Loop the last two steps till we have not received a bit for</p>
<p>If compiled with -DDEBUG_TIMING the 8 IO line are used to output debugging:</p>
<ul>
<li>PIN8: 1=receive mode, 0=send mode</li>
</ul>
<ul>
<li>Receive Mode:<ul>
<li>PIN1: 1=start bit received, 0=function left</li>
<li>PIN2: 1=start overflow interrupt, 0=function left</li>
<li>PIN3: 1=read bit (timer_rec_chars), 0=function left</li>
<li>PIN4: 1=read bit information, 0=bit finished</li>
<li>PIN5: 1=timeout reached (timer_timeout), 0=function left</li>
<li>PIN6: 1=sent ACK (timer_ack), 0=function left</li>
<li>PIN7: 1=bus free (timer_bus_free), 0=function left</li>
</ul>
</li>
</ul>
<ul>
<li>Send Mode:<ul>
<li>PIN1: 1=prepare telegram, 0=function left</li>
<li>PIN2: 1=start overflow interrupt, 0=function left</li>
<li>PIN3: 1=send bit, 0=working on send bit finished</li>
<li>PIN4: 1=check for collision, 0=function left</li>
<li>PIN5: 1=prepare data for ACK, 0=function left</li>
<li>PIN6: 1=waiting for ACK, 0=function left</li>
<li>PIN7: 1=telegram complete, 0=function left</li>
<li>PIN5, PIN6, PIN7: 1=tx_error, repeat telegram, 0=function left</li>
</ul>
</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000085">Todo:</a></b></dt><dd>Die Timerwerte sollten nochmal nachgerechnet/nachgemessen werden. </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a2e40927e90dbc67fee20880a98158835"></a><!-- doxytag: member="fb_hal.c::DISABLE_RF_INTERRUPTS" ref="a2e40927e90dbc67fee20880a98158835" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DISABLE_RF_INTERRUPTS</td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">{ \
          }
</pre></div>
</div>
</div>
<a class="anchor" id="a7bb97dbc2abccfc6ec4a1da276be1352"></a><!-- doxytag: member="fb_hal.c::EIB_BIT_TIME" ref="a7bb97dbc2abccfc6ec4a1da276be1352" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EIB_BIT_TIME&#160;&#160;&#160;F_CPU/(8000000/104)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>duration of one bit on the EIB </p>

<p>Referenced by <a class="el" href="fb__hal_8c.html#a1d2bce7e6ac0dd55aa811e53722ea4be">fbhal_Init()</a>.</p>

</div>
</div>
<a class="anchor" id="a56e22527b5751ef05494c349efbf3efc"></a><!-- doxytag: member="fb_hal.c::EIB_CHECK_FOR_COLLISION" ref="a56e22527b5751ef05494c349efbf3efc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EIB_CHECK_FOR_COLLISION&#160;&#160;&#160;(1&lt;&lt;2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>defined if in transmit mode we have to check if a collision occured </p>

</div>
</div>
<a class="anchor" id="ac7553420ae73a48c64bc99ebae0cb1ed"></a><!-- doxytag: member="fb_hal.c::EIB_NONE_MODE" ref="ac7553420ae73a48c64bc99ebae0cb1ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EIB_NONE_MODE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the receive and sending part is in idle mode </p>

<p>Referenced by <a class="el" href="fb__hal_8c.html#a1d2bce7e6ac0dd55aa811e53722ea4be">fbhal_Init()</a>.</p>

</div>
</div>
<a class="anchor" id="a39180a8413181162f840090a165a53c9"></a><!-- doxytag: member="fb_hal.c::EIB_RECEIVE_MODE" ref="a39180a8413181162f840090a165a53c9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EIB_RECEIVE_MODE&#160;&#160;&#160;(1&lt;&lt;1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>defines that we're in receive mode, if the ISR is triggered the receive functions are called </p>

</div>
</div>
<a class="anchor" id="a45a3ce976119aa33a25ed9f6bd62800b"></a><!-- doxytag: member="fb_hal.c::EIB_SEND_MODE" ref="a45a3ce976119aa33a25ed9f6bd62800b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EIB_SEND_MODE&#160;&#160;&#160;(1&lt;&lt;0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>defines that we're in send mode, if the ISR is triggered the send functions are called </p>

</div>
</div>
<a class="anchor" id="a2cf896253e5acd1e09eed4491b432656"></a><!-- doxytag: member="fb_hal.c::ENABLE_RF_INTERRUPTS" ref="a2cf896253e5acd1e09eed4491b432656" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ENABLE_RF_INTERRUPTS</td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">{ \
          }
</pre></div>
</div>
</div>
<a class="anchor" id="a4840974af68cdfcf383a6408cf7897fa"></a><!-- doxytag: member="fb_hal.c::START_TX" ref="a4840974af68cdfcf383a6408cf7897fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define START_TX</td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">{ \
          <a class="code" href="freebus-atmega168_8h.html#adda77ca346120bfa4af403b6abc26d51" title="clear pending interrupts INT0 and enable interrupt">ENABLE_RX_INT</a>();  <span class="comment">/* we need rx int for collision detect  */</span> \
          operationMode=<a class="code" href="fb__hal_8c.html#a45a3ce976119aa33a25ed9f6bd62800b" title="defines that we&amp;#39;re in send mode, if the ISR is triggered the send functions are called...">EIB_SEND_MODE</a>;       <span class="comment">/* set send mode for operation */</span> \
          START_EIB_TIMER ( <a class="code" href="fb__hal_8c.html#a7bb97dbc2abccfc6ec4a1da276be1352" title="duration of one bit on the EIB">EIB_BIT_TIME</a>/3 ); \
          DEBUG_PIN8_OFF(); }
</pre></div>
<p>start timer: Timer0 using only timer0 to have timer1 and timer2 free for the application </p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="af24054d97e225ff81412767e9e92780b"></a><!-- doxytag: member="fb_hal.c::etimer_state" ref="af24054d97e225ff81412767e9e92780b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780b">etimer_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Status for receiving mode, is used in the ISR to decide which function must be called next. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af24054d97e225ff81412767e9e92780ba95f116553b8e2d1cd7be8a22840d1cf2"></a><!-- doxytag: member="TS_WAITING_CHARS" ref="af24054d97e225ff81412767e9e92780ba95f116553b8e2d1cd7be8a22840d1cf2" args="" -->TS_WAITING_CHARS</em>&nbsp;</td><td>
<p>normal operation, waiting for characters </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af24054d97e225ff81412767e9e92780ba4edb33432ce91da9dbc2877fa520fc2f"></a><!-- doxytag: member="TS_WAITING_TIMEOUT" ref="af24054d97e225ff81412767e9e92780ba4edb33432ce91da9dbc2877fa520fc2f" args="" -->TS_WAITING_TIMEOUT</em>&nbsp;</td><td>
<p>frame received, waiting for timeout or more data ca. 300탎 </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af24054d97e225ff81412767e9e92780ba33c7a599ee9d3fbffdd9424fa8103a74"></a><!-- doxytag: member="TS_WAITING_ACK" ref="af24054d97e225ff81412767e9e92780ba33c7a599ee9d3fbffdd9424fa8103a74" args="" -->TS_WAITING_ACK</em>&nbsp;</td><td>
<p>data received, time to send ack 1.2ms </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af24054d97e225ff81412767e9e92780baea28c3b68095d1841dc25772ee911ccf"></a><!-- doxytag: member="TS_WAITING_ACK_RESP" ref="af24054d97e225ff81412767e9e92780baea28c3b68095d1841dc25772ee911ccf" args="" -->TS_WAITING_ACK_RESP</em>&nbsp;</td><td>
<p>no ack received </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af24054d97e225ff81412767e9e92780baafdffc11056a3e174f83508e3977d6e2"></a><!-- doxytag: member="TS_WAITING_BUS_FREE" ref="af24054d97e225ff81412767e9e92780baafdffc11056a3e174f83508e3977d6e2" args="" -->TS_WAITING_BUS_FREE</em>&nbsp;</td><td>
<p>data received, waiting for timeout or more data 5ms </p>
</td></tr>
</table>
</dd>
</dl>

</div>
</div>
<a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcb"></a><!-- doxytag: member="fb_hal.c::etx_state" ref="ad04bb26f006f4041eeedd64c90e10dcb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="fb__hal_8c.html#ad04bb26f006f4041eeedd64c90e10dcb">etx_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Status for transmitting mode, is used in the ISR to decide which function must be called next. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcba95f419c69e376d2b98405394bdb5fa1c"></a><!-- doxytag: member="TX_NONE" ref="ad04bb26f006f4041eeedd64c90e10dcba95f419c69e376d2b98405394bdb5fa1c" args="" -->TX_NONE</em>&nbsp;</td><td>
<p>doing nothing </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcba392e67967765fc36b13fa57431d05e6d"></a><!-- doxytag: member="TX_SEND_DATA" ref="ad04bb26f006f4041eeedd64c90e10dcba392e67967765fc36b13fa57431d05e6d" args="" -->TX_SEND_DATA</em>&nbsp;</td><td>
<p>currently sending data </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcba0e7b1023eb5c47a8c27126c4c6320e3c"></a><!-- doxytag: member="TX_SEND_CHECKSUM" ref="ad04bb26f006f4041eeedd64c90e10dcba0e7b1023eb5c47a8c27126c4c6320e3c" args="" -->TX_SEND_CHECKSUM</em>&nbsp;</td><td>
<p>sending checksum </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcba9b380c6ca3d4b5a70e5649ca12f180ff"></a><!-- doxytag: member="TX_WAITING_ACK" ref="ad04bb26f006f4041eeedd64c90e10dcba9b380c6ca3d4b5a70e5649ca12f180ff" args="" -->TX_WAITING_ACK</em>&nbsp;</td><td>
<p>waiting for ACK </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad04bb26f006f4041eeedd64c90e10dcbaae441d024d64d59f65315abb3112bfec"></a><!-- doxytag: member="TX_ERROR" ref="ad04bb26f006f4041eeedd64c90e10dcbaae441d024d64d59f65315abb3112bfec" args="" -->TX_ERROR</em>&nbsp;</td><td>
<p>error in sending data occured </p>
</td></tr>
</table>
</dd>
</dl>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adc42490ec5de72809d53c35e57198de6"></a><!-- doxytag: member="fb_hal.c::fb_hal_restart" ref="adc42490ec5de72809d53c35e57198de6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fb_hal_restart </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Restart the application by activating the watchdog and block the program. </p>

<p>References <a class="el" href="freebus-atmega168_8h.html#a2b38be97fd3da86e404ddc4fdea79bb7">ENABLE_WATCHDOG</a>.</p>

<p>Referenced by <a class="el" href="fb__prot_8c.html#a088341f3603f5de9eb4817a8199391c6">A_Restart()</a>.</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the caller graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_adc42490ec5de72809d53c35e57198de6_icgraph.png" border="0" usemap="#fb__hal_8c_adc42490ec5de72809d53c35e57198de6_icgraph" alt=""/></div>
<map name="fb__hal_8c_adc42490ec5de72809d53c35e57198de6_icgraph" id="fb__hal_8c_adc42490ec5de72809d53c35e57198de6_icgraph">
<area shape="rect" id="node3" href="fb__prot_8c.html#a088341f3603f5de9eb4817a8199391c6" title="Restart the program on the microcontroller." alt="" coords="155,5,235,35"/></map>
<!-- endSectionContent --></div>
</p>

</div>
</div>
<a class="anchor" id="abbf23a2adcf8b8280c8ce17d4a12951b"></a><!-- doxytag: member="fb_hal.c::fb_hal_txqueue_msg" ref="abbf23a2adcf8b8280c8ce17d4a12951b" args="(struct msg *tx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fb_hal_txqueue_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmsg.html">msg</a> *&#160;</td>
          <td class="paramname"> <em>tx</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue message for sending. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">tx</td><td>Pointer to message</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

<p>References <a class="el" href="msg__queue_8h.html#af35d846267d1aaaf1df04c8bff03047e">queuemsg()</a>.</p>

<p>Referenced by <a class="el" href="fb__prot_8c.html#a4a0be801ed4f2d9b2cbce548adf56a76">A_ADC_Read()</a>, <a class="el" href="fb__prot_8c.html#a37d55968595e78e21dc1dba21418acf4">A_DeviceDescriptor_Read()</a>, <a class="el" href="fb__prot_8c.html#af2931210aae10a2c39698d2f1fb3c98c">A_Memory_Read()</a>, <a class="el" href="fb__prot_8c.html#ae42ed05d4ccf0a841bdaa32fe7af4478">A_PhysicalAddress_Read()</a>, <a class="el" href="fb__prot_8c.html#a349ae562a88e3299f95943d9dcc2d794">fbprot_msg_handler()</a>, <a class="el" href="fb__prot_8c.html#a440973c20d3055721521a359aee68536">ncd_resp()</a>, <a class="el" href="fb__2-dimmer__app_8c.html#acdb92216340d9fc010cc12bbb44bbfb2">readApplication()</a>, <a class="el" href="fb__prot_8c.html#ade80ef84f4f14d25a2283b43d9c1a54f">sendExtTelegram()</a>, and <a class="el" href="fb__prot_8c.html#a990a78673785da5bb024bfaf60e0984a">sendTelegram()</a>.</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the call graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_cgraph.png" border="0" usemap="#fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_cgraph" alt=""/></div>
<map name="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_cgraph" id="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_cgraph">
<area shape="rect" id="node3" href="msg__queue_8h.html#af35d846267d1aaaf1df04c8bff03047e" title="Add a new message to the message queue." alt="" coords="208,5,299,35"/></map>
<!-- endSectionContent --></div>
</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the caller graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_icgraph.png" border="0" usemap="#fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_icgraph" alt=""/></div>
<map name="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_icgraph" id="fb__hal_8c_abbf23a2adcf8b8280c8ce17d4a12951b_icgraph">
<area shape="rect" id="node3" href="fb__prot_8c.html#a4a0be801ed4f2d9b2cbce548adf56a76" title="Read the values from the ADC converter." alt="" coords="479,5,583,35"/><area shape="rect" id="node5" href="fb__prot_8c.html#a37d55968595e78e21dc1dba21418acf4" title="Is called if information for the BCU type is requested." alt="" coords="437,59,624,88"/><area shape="rect" id="node7" href="fb__prot_8c.html#af2931210aae10a2c39698d2f1fb3c98c" title="Read data from eeprom and return send it as telegram back to the requester." alt="" coords="467,165,595,195"/><area shape="rect" id="node9" href="fb__prot_8c.html#ae42ed05d4ccf0a841bdaa32fe7af4478" title="Returns the address of the device." alt="" coords="209,215,388,244"/><area shape="rect" id="node11" href="fb__prot_8c.html#a349ae562a88e3299f95943d9dcc2d794" title="That function is called from main loop." alt="" coords="224,268,373,297"/><area shape="rect" id="node15" href="fb__prot_8c.html#a440973c20d3055721521a359aee68536" title="Sicherungslayer." alt="" coords="259,111,339,140"/><area shape="rect" id="node22" href="fb__2-dimmer__app_8c.html#acdb92216340d9fc010cc12bbb44bbfb2" title="Read status from port and return it." alt="" coords="239,321,359,351"/><area shape="rect" id="node24" href="fb__prot_8c.html#ade80ef84f4f14d25a2283b43d9c1a54f" title="Send telegram as response to signal current state of the port to other devices." alt="" coords="233,375,364,404"/><area shape="rect" id="node26" href="fb__prot_8c.html#a990a78673785da5bb024bfaf60e0984a" title="Send telegram as response to signal current state of the port to other devices." alt="" coords="243,428,355,457"/><area shape="rect" id="node13" href="fb__in8__app_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The start point of the program, init all libraries, start the bus interface, the application and chec..." alt="" coords="504,268,557,297"/><area shape="rect" id="node20" href="fb__prot_8c.html#afae8acdc71d1ebff494c621459c097cf" title="Write recieved data to the eeprom." alt="" coords="467,112,595,141"/><area shape="rect" id="node28" href="fb__in8__app_8c.html#a8d1473313842fe123fec771c086af269" title="Port Function: Jalousie." alt="" coords="464,375,597,404"/><area shape="rect" id="node30" href="fb__in8__app_8c.html#a71a91b98ae9a796dac4ab23c7e3ff6d8" title="Port Function: switch." alt="" coords="468,428,593,457"/><area shape="rect" id="node32" href="fb__relais__app_8c.html#a1f6d9eb16dbc08dfcfac5f8ceb8d7f40" title="processOutputs" alt="" coords="469,481,592,511"/><area shape="rect" id="node34" href="fb__relais__app_8c.html#a30773cfc4105728c9628fca36c8c7c20" title="Function is called if A_GroupValue_Write is received." alt="" coords="673,481,785,511"/></map>
<!-- endSectionContent --></div>
</p>

</div>
</div>
<a class="anchor" id="a296f7c3289677f2b99af85e65dfd04e0"></a><!-- doxytag: member="fb_hal.c::fb_send_ack" ref="a296f7c3289677f2b99af85e65dfd04e0" args="(uint8_t value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fb_send_ack </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>value</em>&#160;)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Function to set the ack value for the response to a telegram which must be send in a absolutly excat timing. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>Ackvalue can be FB_ACK, FB_NACK, FB_BUSY and FB_NONE </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="fb__ain10v_8c.html#a3f0c55f449560b03ce0ac43270c26600">value</a>.</p>

<p>Referenced by <a class="el" href="fb__prot_8c.html#a4a0be801ed4f2d9b2cbce548adf56a76">A_ADC_Read()</a>, <a class="el" href="fb__prot_8c.html#a37d55968595e78e21dc1dba21418acf4">A_DeviceDescriptor_Read()</a>, <a class="el" href="fb__prot_8c.html#ae56aada1e48493023c8f3ecf7a1e71a7">A_GroupValue_Read()</a>, <a class="el" href="fb__prot_8c.html#abb5d4fc672e3e3e123f5f3e6e9f901e3">A_GroupValue_Write()</a>, <a class="el" href="fb__prot_8c.html#af2931210aae10a2c39698d2f1fb3c98c">A_Memory_Read()</a>, <a class="el" href="fb__prot_8c.html#afae8acdc71d1ebff494c621459c097cf">A_Memory_Write()</a>, <a class="el" href="fb__prot_8c.html#ae42ed05d4ccf0a841bdaa32fe7af4478">A_PhysicalAddress_Read()</a>, <a class="el" href="fb__prot_8c.html#ac3b30c7591e51974ab895440929395c6">A_PhysicalAddress_Write()</a>, <a class="el" href="fb__prot_8c.html#a349ae562a88e3299f95943d9dcc2d794">fbprot_msg_handler()</a>, <a class="el" href="fb__prot_8c.html#a5928e9483083ad86d6c82f0b0ca533af">Ignore()</a>, <a class="el" href="fb__prot_8c.html#a3b317425f1358ea37c8fca124e29c277">T_Connect_Req()</a>, and <a class="el" href="fb__prot_8c.html#a0675ad49aa389619806157f585c466ee">T_Disconnect_Req()</a>.</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the caller graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_a296f7c3289677f2b99af85e65dfd04e0_icgraph.png" border="0" usemap="#fb__hal_8c_a296f7c3289677f2b99af85e65dfd04e0_icgraph" alt=""/></div>
<map name="fb__hal_8c_a296f7c3289677f2b99af85e65dfd04e0_icgraph" id="fb__hal_8c_a296f7c3289677f2b99af85e65dfd04e0_icgraph">
<area shape="rect" id="node3" href="fb__prot_8c.html#a4a0be801ed4f2d9b2cbce548adf56a76" title="Read the values from the ADC converter." alt="" coords="196,5,300,35"/><area shape="rect" id="node5" href="fb__prot_8c.html#a37d55968595e78e21dc1dba21418acf4" title="Is called if information for the BCU type is requested." alt="" coords="155,59,341,88"/><area shape="rect" id="node7" href="fb__prot_8c.html#ae56aada1e48493023c8f3ecf7a1e71a7" title="A read request to the application." alt="" coords="173,112,323,141"/><area shape="rect" id="node9" href="fb__prot_8c.html#abb5d4fc672e3e3e123f5f3e6e9f901e3" title="Is called if a broadcast is received with a matching group address (eg." alt="" coords="173,165,323,195"/><area shape="rect" id="node11" href="fb__prot_8c.html#af2931210aae10a2c39698d2f1fb3c98c" title="Read data from eeprom and return send it as telegram back to the requester." alt="" coords="184,219,312,248"/><area shape="rect" id="node13" href="fb__prot_8c.html#afae8acdc71d1ebff494c621459c097cf" title="Write recieved data to the eeprom." alt="" coords="184,272,312,301"/><area shape="rect" id="node15" href="fb__prot_8c.html#ae42ed05d4ccf0a841bdaa32fe7af4478" title="Returns the address of the device." alt="" coords="159,325,337,355"/><area shape="rect" id="node17" href="fb__prot_8c.html#ac3b30c7591e51974ab895440929395c6" title="Set the received address as our new device address." alt="" coords="159,379,337,408"/><area shape="rect" id="node19" href="fb__prot_8c.html#a349ae562a88e3299f95943d9dcc2d794" title="That function is called from main loop." alt="" coords="173,432,323,461"/><area shape="rect" id="node23" href="fb__prot_8c.html#a5928e9483083ad86d6c82f0b0ca533af" title="Send aknowledge to certain message." alt="" coords="217,485,279,515"/><area shape="rect" id="node25" href="fb__prot_8c.html#a3b317425f1358ea37c8fca124e29c277" title="Called to start a connection to a physical address." alt="" coords="188,539,308,568"/><area shape="rect" id="node27" href="fb__prot_8c.html#a0675ad49aa389619806157f585c466ee" title="Release the transport connection." alt="" coords="179,592,317,621"/><area shape="rect" id="node21" href="fb__in8__app_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The start point of the program, init all libraries, start the bus interface, the application and chec..." alt="" coords="391,432,444,461"/></map>
<!-- endSectionContent --></div>
</p>

</div>
</div>
<a class="anchor" id="a85ef2600dfae61cd15f445efbc31fb60"></a><!-- doxytag: member="fb_hal.c::fbhal_checkProgTaster" ref="a85ef2600dfae61cd15f445efbc31fb60" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fbhal_checkProgTaster </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check the programm button and set programming mode and switch LED depending on programming mode. </p>
<p>Programm button is on PB0 and pin 4 on Freebus connector.</p>
<p>Function detects the state of the prog button (debounced) and sets the programming mode. This is done only every 16th call, because the 킗 needs some time to switch from output to input mode and so we got more negative duty cylce for the prog led.</p>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>The macro SET_IO_PROG(IO_OUTPUT) could not be used here, because this sets the DDR and also the PORT = 0. This won't work. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000086">Todo:</a></b></dt><dd>Check if this function is working fine. </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Matthias Fechner, Tobias Buss </dd></dl>

<p>References <a class="el" href="delay_8h.html#adeb129e484b57c960e4a118fab9cdb21">delay</a>, <a class="el" href="freebus-atmega168_8h.html#af08f963b06ce58883a37343e92584fec">PROG_DDR</a>, <a class="el" href="freebus-atmega168_8h.html#a8aaceef1e80ae3b6c312a3748f1eea55">PROG_PIN</a>, <a class="el" href="freebus-atmega168_8h.html#a4459092141141443dccc90a3fff94fbf">PROG_PORT</a>, <a class="el" href="fb_8h.html#aff0cdfa8a30dbfdad5cc03301ba601ff">SS_PROG</a>, and <a class="el" href="fb__hal_8h.html#a53ac9c8b9cfb94746b9f5b39bf152620">systemState</a>.</p>

<p>Referenced by <a class="el" href="fb__ain10v_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main()</a>.</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the caller graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_a85ef2600dfae61cd15f445efbc31fb60_icgraph.png" border="0" usemap="#fb__hal_8c_a85ef2600dfae61cd15f445efbc31fb60_icgraph" alt=""/></div>
<map name="fb__hal_8c_a85ef2600dfae61cd15f445efbc31fb60_icgraph" id="fb__hal_8c_a85ef2600dfae61cd15f445efbc31fb60_icgraph">
<area shape="rect" id="node3" href="fb__ain10v_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The start point of the program, init all libraries, start the bus interface, the application and chec..." alt="" coords="220,5,273,35"/></map>
<!-- endSectionContent --></div>
</p>

</div>
</div>
<a class="anchor" id="a1d2bce7e6ac0dd55aa811e53722ea4be"></a><!-- doxytag: member="fb_hal.c::fbhal_Init" ref="a1d2bce7e6ac0dd55aa811e53722ea4be" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fbhal_Init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set input/output mode to PORTs, init timers and interrupts. </p>

<p>References <a class="el" href="freebus-atmega168_8h.html#a06a8b1381f40ae82a34572569ab83486">CONFIGURE_INT0</a>, <a class="el" href="fb__hal_8c.html#a7bb97dbc2abccfc6ec4a1da276be1352">EIB_BIT_TIME</a>, <a class="el" href="fb__hal_8c.html#ac7553420ae73a48c64bc99ebae0cb1ed">EIB_NONE_MODE</a>, <a class="el" href="freebus-atmega168_8h.html#adda77ca346120bfa4af403b6abc26d51">ENABLE_RX_INT</a>, <a class="el" href="fb__hal_8h.html#ab26a4ae4e4ada896a31f54f982289c32">FB_BUS_FREE</a>, <a class="el" href="fb__hal_8h.html#a3c1a27aacf1dd33edffa2422da638d0f">IO_INPUT</a>, <a class="el" href="fb__hal_8h.html#aae48313230e7f773bf495ada1171c506">IO_OUTPUT</a>, <a class="el" href="fb__hal_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>, <a class="el" href="fb__hal_8h.html#a53ac9c8b9cfb94746b9f5b39bf152620">systemState</a>, and <a class="el" href="fb__hal_8c.html#af24054d97e225ff81412767e9e92780ba95f116553b8e2d1cd7be8a22840d1cf2">TS_WAITING_CHARS</a>.</p>

<p>Referenced by <a class="el" href="fb__adc_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main()</a>.</p>

<p><!-- startSectionHeader --><div class="dynheader">
Here is the caller graph for this function:<!-- endSectionHeader --></div>
<!-- startSectionSummary --><!-- endSectionSummary --><!-- startSectionContent --><div class="dyncontent">
<div class="center"><img src="fb__hal_8c_a1d2bce7e6ac0dd55aa811e53722ea4be_icgraph.png" border="0" usemap="#fb__hal_8c_a1d2bce7e6ac0dd55aa811e53722ea4be_icgraph" alt=""/></div>
<map name="fb__hal_8c_a1d2bce7e6ac0dd55aa811e53722ea4be_icgraph" id="fb__hal_8c_a1d2bce7e6ac0dd55aa811e53722ea4be_icgraph">
<area shape="rect" id="node3" href="fb__adc_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The start point of the program, init all libraries, start the bus interface, the application and chec..." alt="" coords="135,5,188,35"/></map>
<!-- endSectionContent --></div>
</p>

</div>
</div>
<a class="anchor" id="a30c6b413389944e9362e0bb20467962e"></a><!-- doxytag: member="fb_hal.c::panic" ref="a30c6b413389944e9362e0bb20467962e" args="(uint8_t reason)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void panic </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>reason</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hold application and set blink code to PORTB pin 0, our prog pin and LED. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000087">Todo:</a></b></dt><dd>Replace that function with a mechanism that not completely kills the controller application </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">reason</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="fb__hal_8h.html#aae48313230e7f773bf495ada1171c506">IO_OUTPUT</a>, <a class="el" href="fb__hal_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>, and <a class="el" href="fb__hal_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Mar 7 2011 10:08:42 for FreeBusAVR by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
